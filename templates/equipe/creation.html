{% extends "base.html %"}
{% block title %}Cr√©er une √©quipe{% endblock %}

{% block main %}
<link rel="stylesheet" type="text/css" href="/templates/styles/equipe_creer.css" />
<body>
  <div class="container">
  <h1>Cr√©er une nouvelle √©quipe</h1>

  <!-- Messages renvoy√©s par le serveur -->
  {% if REQUEST_VARS.get('tentative_creation_equipe') %}
  <div class="messages">
    {% if REQUEST_VARS.get('success') %}
      <div class="alert alert-success">‚úÖ {{ REQUEST_VARS['success'] }}</div>
    {% endif %}

    {% for key in ['err_format_couleur', 'err_nombre_morpion', 'err_nom_indisponible',
                   'err_format_nom', 'err_insertion'] %}
      {% if REQUEST_VARS.get(key) %}
        <div class="alert alert-error">‚ùå {{ REQUEST_VARS[key] }}</div>
      {% endif %}
    {% endfor %}

    {% if REQUEST_VARS.get('champ_manquant') %}
      <div class="alert alert-error">‚ùå Champs manquants : {{ REQUEST_VARS['champ_manquant']|join(', ') }}</div>
    {% endif %}
  </div>
  {% endif %}

  <!-- Formulaire -->
  <form method="post" action="" id="team-form">
    <!-- Nom -->
    <fieldset>
      <label for="nom">Nom de l'√©quipe *</label>
      <input type="text" id="nom" name="nom"
             value="{{ REQUEST_VARS.get('nom', [''])[0] if REQUEST_VARS.get('nom') else '' }}"
             maxlength="50" required>
      <div class="help-text">Maximum 50 caract√®res</div>
    </fieldset>

    <!-- Couleur -->
    <fieldset>
      <label for="couleur">Couleur *</label>
      <input type="color" id="couleur" name="couleur"
             value="{{ REQUEST_VARS.get('couleur', ['#FF0000'])[0] if REQUEST_VARS.get('couleur') else '#FF0000' }}"
             required>
      <div class="help-text">Choisissez une couleur unique</div>
    </fieldset>

    <!-- Morpions : cases carr√©es avec images -->
    <fieldset>
      <legend>S√©lection des morpions * (6 √† 8)</legend>

      <div class="morpion-grid">
        {% for morpion in REQUEST_VARS.get('liste_morpion', []) %}
          {# on suppose morpion[2] = url image, morpion[1] = nom, morpion[0] = id #}
          {% set img_url = morpion[2] if (morpion|length > 2 and morpion[2]) else '/static/placeholder.png' %}
          {% set submitted = REQUEST_VARS.get('morpions') %}
          {% set checked = False %}
          {% if submitted %}
            {# comparer en string car REQUEST_VARS contient souvent des strings #}
            {% if morpion[0]|string in submitted %}{% set checked = True %}{% endif %}
          {% endif %}
          <label class="morpion-card {% if checked %}selected{% endif %}">
            <input type="checkbox" name="morpions[]" value="{{ morpion[0] }}"
                   {% if checked %}checked{% endif %}>
            <img src="{{ img_url }}" alt="{{ morpion[1] }}">
            <div class="morpion-name">{{ morpion[1] }}</div>
          </label>
        {% endfor %}
      </div>

      <div class="help-text">Cliquez sur les cases pour s√©lectionner. S√©lection requise : 6 √† 8.</div>
      <div id="client-error" class="client-error" style="display:none;"></div>
    </fieldset>

    <button type="submit">üöÄ Cr√©er l'√©quipe</button>
  </form>
</div>
</body>
{% endblock %}